<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Anand Love Sneha ‚Äî Dynamic Moon v5.0</title>
<style>
:root{--bg1:#100625;--text:#fff}
html,body{height:100%;margin:0;background:radial-gradient(circle at 50% 18%, #151033 0%, #06021a 60%, #01000a 100%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--text);overflow:hidden}
canvas{position:fixed;inset:0;display:block;pointer-events:none;z-index:0}

/* moon container ‚Äî matches screenshot: centered, big */
#moonWrap{
  position:fixed;left:50%;top:38%;transform:translate(-50%,-38%);z-index:1;
  width:54vmin;max-width:760px;min-width:360px;height:54vmin;border-radius:50%;overflow:hidden;pointer-events:none;
  opacity:1; /* moon image itself will be semi-transparent */
}
#moonImg{
  width:100%;height:100%;object-fit:cover;border-radius:50%;display:block;
  filter:brightness(1.02) contrast(1.05);opacity:.95;
  -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 98%, rgba(0,0,0,0) 100%);
          mask-image: radial-gradient(circle, rgba(0,0,0,1) 98%, rgba(0,0,0,0) 100%);
  will-change:transform,filter,opacity,mask-image;
}

/* title in front of moon (large center) */
.titleWrap{position:fixed;left:50%;top:38%;transform:translate(-50%,-38%);z-index:3;text-align:center;pointer-events:none}
.title{font-size:clamp(28px,5.2vw,56px);margin:0;font-weight:700;text-shadow:0 14px 40px rgba(0,0,0,0.45)}
.subtitle{margin-top:6px;font-size:clamp(12px,2.2vw,16px);color:rgba(255,255,255,0.8)}

/* tap button fallback */
#tap{position:fixed;left:50%;top:56%;transform:translateX(-50%);z-index:5;display:none;padding:10px 14px;border-radius:999px;border:0;background:rgba(255,255,255,0.08);color:var(--text);cursor:pointer}

/* message fixed below title (lower part of moon) ‚Äî doesn't move */
.message{position:fixed;left:50%;top:62%;transform:translate(-50%,-0%);z-index:3;width:86%;max-width:920px;text-align:center;color:var(--text);font-size:clamp(14px,2.2vw,20px);line-height:1.6;opacity:0;transition:opacity .6s ease;text-shadow:0 2px 10px rgba(0,0,0,0.45)}

.footer{position:fixed;right:12px;bottom:10px;color:rgba(255,255,255,0.45);font-size:12px;z-index:4}

/* small devices */
@media(max-width:640px){
  #moonWrap{top:32%}
  .titleWrap{top:32%}
  #tap{top:52%}
  .message{top:60%}
}
</style>
</head>
<body>
<canvas id="stars"></canvas>
<canvas id="shoot"></canvas>

<!-- moon (image file moon.jpg must be in same folder) -->
<div id="moonWrap" aria-hidden="true">
  <img id="moonImg" src="moon.jpg" alt="Moon texture">
</div>

<!-- main title -->
<div class="titleWrap">
  <div class="title">Anand Love Sneha <span style="font-size:.65em">üíû</span></div>
  <div class="subtitle">Story by Anand</div>
</div>

<!-- tap fallback and message -->
<button id="tap">Tap to play ‚ù§Ô∏è</button>
<div id="message" class="message"></div>

<div class="footer">Made by Anand for Sneha üíû</div>

<audio id="bg" src="music.mp3" preload="auto" loop></audio>

<script>
/* ---------- audio autoplay fallback ---------- */
const bg = document.getElementById('bg'), tap = document.getElementById('tap');
bg.volume = 0.30;
bg.play().then(()=>{ tap.style.display='none' }).catch(()=>{ tap.style.display='block' });
tap.addEventListener('click', ()=>{ bg.play().catch(()=>{}); tap.style.display='none'; }, {once:true});

/* ---------- starfield + shooting ---------- */
const sC = document.getElementById('stars'), sCtx = sC.getContext('2d');
const shC = document.getElementById('shoot'), shCtx = shC.getContext('2d');
function resize(){ sC.width = shC.width = innerWidth; sC.height = shC.height = innerHeight; }
resize(); addEventListener('resize', resize);

let stars=[];
function makeStars(){
  stars=[]; const count = Math.max(70, Math.floor(innerWidth/12));
  for(let i=0;i<count;i++) stars.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight*0.7,r:Math.random()*1.6+0.2,phase:Math.random()*Math.PI*2,base:Math.random()*0.6+0.2,speed:Math.random()*0.01+0.003});
}
makeStars();

let shoots=[];
function spawnS(){ const fromL = Math.random()>.5; const sx = fromL?-60:innerWidth+60; const sy = Math.random()*innerHeight*0.35+20; const vx = fromL? (Math.random()*6+8) : -(Math.random()*6+8); const vy = (Math.random()*1+0.4); shoots.push({x:sx,y:sy,vx,vy,life:0,ttl:Math.random()*500+700,size:Math.random()*1.4+0.8}) }
setTimeout(function loopSpawn(){ spawnS(); setTimeout(loopSpawn, 4500 + Math.random()*2000) }, 1000);

let last=performance.now();
function loop(now){
  const dt = now - last; last = now;
  // stars
  sCtx.clearRect(0,0,sC.width,sC.height);
  for(let s of stars){
    s.phase += s.speed * dt;
    const a = Math.max(0.15, s.base + 0.5*Math.sin(s.phase));
    sCtx.beginPath(); sCtx.fillStyle = `rgba(255,255,255,${a})`; sCtx.arc(s.x,s.y,s.r,0,Math.PI*2); sCtx.fill();
  }
  // shooting stars
  shCtx.clearRect(0,0,shC.width,shC.height);
  for(let i=shoots.length-1;i>=0;i--){
    const st = shoots[i]; st.life += dt; st.x += st.vx*(dt/16); st.y += st.vy*(dt/16);
    const prog = st.life/st.ttl;
    if(prog>1){ shoots.splice(i,1); continue; }
    shCtx.beginPath(); shCtx.strokeStyle = `rgba(255,255,255,${1-prog*0.95})`; shCtx.lineWidth = st.size; shCtx.moveTo(st.x,st.y); shCtx.lineTo(st.x - st.vx*16*0.08, st.y - st.vy*16*0.08); shCtx.stroke();
    shCtx.beginPath(); shCtx.fillStyle = `rgba(255,255,255,${1-prog*0.95})`; shCtx.arc(st.x,st.y,st.size*1.2,0,Math.PI*2); shCtx.fill();
  }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- moon phase (includes fractional day using time) ---------- */
const moonImg = document.getElementById('moonImg'), moonWrap = document.getElementById('moonWrap');

function calcPhaseFraction(date){
  // more precise fractional moon age using hours/min/sec to update during the day
  const y = date.getFullYear(), m = date.getMonth()+1, d = date.getDate();
  const H = date.getHours(), Min = date.getMinutes(), S = date.getSeconds();
  let yy=y, mm=m;
  if(mm < 3){ yy--; mm+=12; }
  const k1 = Math.floor(365.25*(yy+4712));
  const k2 = Math.floor(30.6001*(mm+1));
  const jd0 = k1 + k2 + d - 1524.5;
  const dayFrac = (H + Min/60 + S/3600)/24;
  const jd = jd0 + dayFrac;
  const syn = 29.53058867;
  let days = (jd - 2451549.5) % syn; if(days < 0) days += syn;
  const phase = days / syn; // 0..1
  return phase;
}

function applyPhaseMask(){
  const phase = calcPhaseFraction(new Date()); // 0..1
  const norm = phase*2 - 1; // -1..1
  // moving dark mask and strength
  const offset = 50 + norm*28; // percent
  const darkStrength = Math.abs(norm) * 0.86;
  const mask = `radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 0%, rgba(0,0,0,${0.02 + darkStrength*0.28}) 55%, rgba(0,0,0,0.98) 100%), linear-gradient(90deg, rgba(0,0,0,0.98) ${offset}%, rgba(0,0,0,0) ${offset + 7}%)`;
  moonImg.style.webkitMaskImage = mask; moonImg.style.maskImage = mask;
  const fullness = Math.sin(phase * Math.PI); // 0..1
  const scale = 0.95 + 0.18 * fullness; // 0.95..1.13
  // alive pulse + drift applied on top later; set base scale here
  moonWrap.dataset.baseScale = scale;
  moonImg.style.filter = `brightness(${0.9 + 0.28*fullness}) contrast(1.06)`;
}
applyPhaseMask();
setInterval(applyPhaseMask, 60*1000); // refresh every minute

/* subtle alive pulse + slow drift (uses base scale from phase) */
let t0 = performance.now();
function animateMoon(){
  const t = (performance.now() - t0)/1000;
  const pulse = 1 + 0.02 * Math.sin(t * 1.6); // slightly more visible pulse
  const floatX = Math.sin(t*0.12) * (innerWidth*0.0009);
  const floatY = Math.cos(t*0.1) * (innerHeight*0.0009);
  const base = parseFloat(moonWrap.dataset.baseScale || 1);
  moonWrap.style.transform = `translate(calc(-50% + ${floatX}px), calc(-38% + ${floatY}px)) scale(${base * pulse})`;
  requestAnimationFrame(animateMoon);
}
requestAnimationFrame(animateMoon);

/* ---------- messages: auto + click-to-advance (stays fixed position) ---------- */
const messages = [
  "A story written in pixels, but felt in every heartbeat üíó",
  "Hey Sneha Shaw, that message about ‚ÄòFir Mohabbat‚Äô started our story üíû",
  "28 Sept 2025 ‚Äî the day my heart found its home üíñ",
  "2 Oct ‚Äî you said ‚ÄòI like you‚Äô and my world changed ‚ú®",
  "4 Oct ‚Äî our first call; your voice was peace, your laugh was home üíû",
  "I can‚Äôt spend a day without your ‚ÄòGood Morning‚Äô and night without your ‚ÄòLove you‚Äô üíñ",
  `Since 27 Sept 2025 ‚Äî it's been ${Math.floor((Date.now()-new Date(2025,8,27))/(1000*60*60*24))} days of love.`,
  "I will always love you, no matter what comes ‚ù§Ô∏è",
  "Na waqt rok saka, na dooriyan tod saki‚Ä¶ meri mohabbat tujhme hi simat gayi üíû"
];
const msgEl = document.getElementById('message');
let idx = 0, timer = null, interval = 8000;

function showMessage(i){
  msgEl.style.opacity = 0;
  setTimeout(()=>{ msgEl.textContent = messages[i]; msgEl.style.opacity = 1; }, 300);
  if(timer) clearTimeout(timer);
  timer = setTimeout(()=>{ nextMessage(); }, interval);
}
function nextMessage(){
  idx = (idx + 1) % messages.length;
  showMessage(idx);
}
showMessage(0);

// click/tap anywhere to advance (ignore taps on the tap button)
document.addEventListener('click', function(e){
  const t = e.target;
  if(t && (t.id==='tap' || t.tagName==='BUTTON' || t.tagName==='A')) return;
  // advance immediately
  if(timer) clearTimeout(timer);
  nextMessage();
}, {passive:true});
document.addEventListener('touchstart', function(e){
  const t = e.target;
  if(t && (t.id==='tap' || t.tagName==='BUTTON' || t.tagName==='A')) return;
  if(timer) clearTimeout(timer);
  nextMessage();
}, {passive:true});

/* update day-count and phase on focus */
window.addEventListener('focus', ()=>{ messages[6] = `Since 27 Sept 2025 ‚Äî it's been ${Math.floor((Date.now()-new Date(2025,8,27))/(1000*60*60*24))} days of love.`; showMessage(idx); applyPhaseMask(); });

/* regenerate stars on resize */
window.addEventListener('resize', ()=>{ makeStars(); });

</script>
</body>
</html>

